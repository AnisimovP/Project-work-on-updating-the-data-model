## 1.1 Требования к целевой витрине

Присвоить каждому клиенту три значения — значение фактора Recency, значение фактора Frequency и значение фактора Monetary Value:
- Фактор Recency измеряется по последнему заказу. Распределите клиентов по шкале от одного до пяти, где значение 1 получат те, кто либо вообще не делал заказов, либо делал их очень давно, а 5 — те, кто заказывал относительно недавно.
- Фактор Frequency оценивается по количеству заказов. Распределите клиентов по шкале от одного до пяти, где значение 1 получат клиенты с наименьшим количеством заказов, а 5 — с наибольшим.
- Фактор Monetary Value оценивается по потраченной сумме. Распределите клиентов по шкале от одного до пяти, где значение 1 получат клиенты с наименьшей суммой, а 5 — с наибольшей.
Проверить, что количество клиентов в каждом сегменте одинаково. Например, если в базе всего 100 клиентов, то 20 клиентов должны получить значение 1, ещё 20 — значение 2 и т. д.

Задача — построить витрину для RFM-классификации. Для анализа нужно отобрать только успешно выполненные заказы.

В схеме production содержатся оперативные таблицы.

Витрина должна располагаться в той же базе в схеме analysis.

Витрина должна состоять из таких полей:
- user_id
- recency (число от 1 до 5)
- frequency (число от 1 до 5)
- monetary_value (число от 1 до 5)

Глубина витрины: данные с начала 2022 года.

Витрина должна называть: dm_rfm_segments

Успешными заказами являются заказы со статусом Closed.

## 1.2 Изучение структуры данных.

Данные будут браться из схемы production, следующих таблиц и соответствующих столбцов:

- Таблица users. Поле id (int4) - Уникальные индекс пользователя
- Таблица orders. Поля: 
						- user_id (int4) - Уникальные индекс пользователя;
						- order_ts (timestamp) - Дата и время заказа;
						- payment(numeric(19,5)) - Сумма оплаты по заказу.
- Таблица orderstatus. Поля:
						- id (int4)  - Уникальные индекс пользователя;
						- key (varchar224) - Статус заказа клиента.

**Процесс решения**

- Изучить структуру данных. Изучить скрипты создания таблиц а также ограничения на ввод данных. Проверить глубину данных.

- Проверить на наличие дубликатов.

- Изучить таблицу с заказами данных. Возможно есть клиенты которые не делали заказ. Их тоже надо будеть учесть в дальнейшем.

- Создать представление для таблиц базы production, чтобы не дублировать данные, которые уже находятся в базе.

- Создать таблицу для витрины данных.

- Создать временные таблицы и заполнить их данными для RFM-классификации клиентов.

- Заполнить витрину данными из временных таблий.

- Обновлить представление orders, для заполнения поля status.